<!DOCTYPE html>
<!--
Copyright 2018 The Go Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<html>
<head>
    <meta charset="utf-8" />
    <title>ED25519 WASM</title>
</head>

<body>
<script src="wasm_exec.js"></script>

<script>
    const load = async () => {
        const response = await fetch('./ed25519.wasm');
        const bytes = await response.arrayBuffer();
        const go = new Go(); // eslint-disable-line no-undef
        const { instance } = await WebAssembly.instantiate(bytes, go.importObject);
        await go.run(instance);
        document.getElementById("runButton").disabled = false;
    };

    // async function run() {
    //     await go.run(inst);
    //     inst = await WebAssembly.instantiate(mod, go.importObject); // reset instance
    // }

    load();

    const enc = new TextEncoder();
    const seed = enc.encode("fae15be1295fb72a0550b4ded5a90b019ec48a16a6dfe4f2f8354f0289b298f7");
    const message = enc.encode('blblblblbllalaal');

    let pk;
    let sk;
    let signature;

    saveKeys = (pk1, sk1, err) => {
        if (typeof err === 'object') {
            console.err('failed to generate keys');
            return;
        }
        console.log(`public key ${pk1}`);
        console.log(`secret key ${sk1}`);
        pk = pk1;
        sk = sk1;
    };

    generateKeys1 = () => {
        __generateKeyPair(seed.slice(0, 32), saveKeys)
    };

    signCall = () => {
        __signTransaction(sk, message, (sig) => signature = sig);
    };

    verify1 = () => {
        __verifyTransaction(pk, message, signature, console.log)
    };

    stopAndCleanUp = () => __stopAndCleanUp()
</script>

<button onClick="run();" id="runButton" disabled>Run</button>
<button onClick="generateKeys1();" id="generateKeysButton">Generate Keys</button>
<button onClick="signCall();" id="addButton">Sign2</button>
<button onClick="verify1();" id="generateKeysButton">Validate</button>
<button onClick="stopAndCleanUp();" id="generateKeysButton">Shutdown</button>
</body>
</html>